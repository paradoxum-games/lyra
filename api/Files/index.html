<!doctype html>
<html lang="en" dir="ltr" class="plugin-moonwave plugin-id-moonwave" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">Files | Lyra</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://paradoxum-games.github.io/lyra/api/Files"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="Files | Lyra"><meta data-rh="true" name="description" content="Handles the storage and retrieval of potentially large data blobs within Roblox DataStores,
working around the size limitations imposed by DataStore `SetAsync`/`GetAsync` calls.

**Core Problem:** Roblox DataStores have a maximum size limit per key (currently 4MB).
Data that exceeds this limit cannot be stored directly.

**Solution: Sharding &amp; Compression**
1.  **Sharding:** If the JSON-encoded data exceeds the configured `maxShardSize`, it is
    split into multiple smaller chunks (shards). Metadata about these shards (a unique
    shard ID and the total shard count) is stored in the primary DataStore entry for the
    original key, while the actual shard data is stored under separate keys derived from
    the shard ID.
2.  **Compression:** Before sharding, the JSON-encoded data is converted to binary using
    `buffer.fromstring`. This binary representation is then JSON-encoded *again* before
    being split into UTF-8 safe shards using `splitUtf8String`. Roblox automatically
	compresses buffers when encoding them using `JSONEncode`. This helps reduce the
    number of shards required, minimizing DataStore requests.

**Shard Key Naming:** Shard data is stored using keys formatted as `{shardId}-{shardIndex}`,
where `shardId` is a unique GUID generated for the file and `shardIndex` is the 1-based
index of the shard."><meta data-rh="true" property="og:description" content="Handles the storage and retrieval of potentially large data blobs within Roblox DataStores,
working around the size limitations imposed by DataStore `SetAsync`/`GetAsync` calls.

**Core Problem:** Roblox DataStores have a maximum size limit per key (currently 4MB).
Data that exceeds this limit cannot be stored directly.

**Solution: Sharding &amp; Compression**
1.  **Sharding:** If the JSON-encoded data exceeds the configured `maxShardSize`, it is
    split into multiple smaller chunks (shards). Metadata about these shards (a unique
    shard ID and the total shard count) is stored in the primary DataStore entry for the
    original key, while the actual shard data is stored under separate keys derived from
    the shard ID.
2.  **Compression:** Before sharding, the JSON-encoded data is converted to binary using
    `buffer.fromstring`. This binary representation is then JSON-encoded *again* before
    being split into UTF-8 safe shards using `splitUtf8String`. Roblox automatically
	compresses buffers when encoding them using `JSONEncode`. This helps reduce the
    number of shards required, minimizing DataStore requests.

**Shard Key Naming:** Shard data is stored using keys formatted as `{shardId}-{shardIndex}`,
where `shardId` is a unique GUID generated for the file and `shardIndex` is the 1-based
index of the shard."><link data-rh="true" rel="canonical" href="https://paradoxum-games.github.io/lyra/api/Files"><link data-rh="true" rel="alternate" href="https://paradoxum-games.github.io/lyra/api/Files" hreflang="en"><link data-rh="true" rel="alternate" href="https://paradoxum-games.github.io/lyra/api/Files" hreflang="x-default"><link rel="stylesheet" href="/lyra/assets/css/styles.f56ecc6a.css">
<script src="/lyra/assets/js/runtime~main.4a9be780.js" defer="defer"></script>
<script src="/lyra/assets/js/main.3498456b.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();null!==e?t(e):window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,t("light"))}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/lyra/"><b class="navbar__title text--truncate">Lyra</b></a><a class="navbar__item navbar__link" href="/lyra/docs/intro">Docs</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/lyra/api/">API</a><a class="navbar__item navbar__link" href="/lyra/changelog">Changelog</a></div><div class="navbar__items navbar__items--right"><a href="https://wally.run/package/paradoxum-games/lyra" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Wally<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://github.com/paradoxum-games/lyra" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="navbar__search"><span aria-label="expand searchbar" role="button" class="search-icon" tabindex="0"></span><input id="search_input_react" type="search" placeholder="Loading..." aria-label="Search" class="navbar__search-input search-bar" disabled=""></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docPageContainer_wNNk"><div class="docPage_Dpn1"><div class="docSidebarContainer_o_re"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/lyra/api/PlayerStore">​Player​Store</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/lyra/api/Lyra">​Lyra</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/lyra/api/Store">Internal</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/lyra/api/Store">​Store</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/lyra/api/Session">​Session</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/lyra/api/Locks">​Locks</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/lyra/api/Constants">​Constants</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/lyra/api/Files">​Files</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/lyra/api/Log">​Log</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/lyra/api/PromiseQueue">​Promise​Queue</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/lyra/api/Types">​Types</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/lyra/api/Transactions">​Transactions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/lyra/api/Migrations">​Migrations</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/lyra/api/hashMapRetry">hash​Map​Retry</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/lyra/api/dataStoreRetry">data​Store​Retry</a></li></ul></li></ul></nav></div></div><main class="docMainContainer_HJE1"><div class="container padding-vert--lg"><div class="row"><div class="col docItemCol_MU3C"><div class="docItemContainer_Wv98"><article><div class="member_J0w1 markdown"><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_oUs_"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><header><h1 class="docTitle_mZRt" style="text-decoration:none"><span style="display:inline-block">Files</span></h1><div class="luaClassTags_EipM"><span class="badge_Ba2I" style="color:#9b59b6"><span class="badgeTooltip_cWXP">This item is only intended to be used by the module&#x27;s authors.</span><span class="badgeToolTipTail_H9D_"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" fill="#9b59b6" role="img" aria-label="This item is only intended to be used by the module&#x27;s authors."><path d="m49.2 36 14.3 12.7.1-.7c0-6.7-6.1-12.1-13.6-12.1l-.8.1z"></path><path d="M50 27.8c12.5 0 22.7 9 22.7 20.1 0 2.6-.6 5-1.6 7.3L84.4 67c6.9-5 12.3-11.6 15.6-19.1-7.9-17.6-27.3-30.1-50-30.1-6.4 0-12.5 1-18.1 2.8l9.8 8.6c2.6-.8 5.4-1.4 8.3-1.4zM4.5 16.9l10.4 9.2 2.1 1.8C9.5 33.1 3.5 40 0 48c7.9 17.7 27.3 30.2 50 30.2 7 0 13.8-1.2 19.9-3.4l1.9 1.7 13.3 11.7 5.8-5.1-80.6-71.3-5.8 5.1zm25.2 22.2 7 6.2c-.2.8-.3 1.8-.3 2.6C36.4 54.6 42.5 60 50 60c1 0 2-.2 3-.3l7 6.2c-3 1.3-6.4 2.1-10 2.1-12.5 0-22.7-9-22.7-20.1 0-3.1.9-6.1 2.4-8.8z"></path></svg> <!-- -->Private</span></span></div><div>
<p>
  Handles the storage and retrieval of potentially large data blobs within Roblox DataStores,
  working around the size limitations imposed by DataStore <code>SetAsync</code>/<code>GetAsync</code> calls.
</p>
<p>
  <strong>Core Problem:</strong> Roblox DataStores have a maximum size limit per key (currently 4MB).
  Data that exceeds this limit cannot be stored directly.
</p>
<p><strong>Solution: Sharding &#x26; Compression</strong></p>
<ol>
  <li>
    <strong>Sharding:</strong> If the JSON-encoded data exceeds the configured <code>maxShardSize</code>, it is
    split into multiple smaller chunks (shards). Metadata about these shards (a unique
    shard ID and the total shard count) is stored in the primary DataStore entry for the
    original key, while the actual shard data is stored under separate keys derived from
    the shard ID.
  </li>
  <li>
    <strong>Compression:</strong> Before sharding, the JSON-encoded data is converted to binary using
    <code>buffer.fromstring</code>. This binary representation is then JSON-encoded <em>again</em> before
    being split into UTF-8 safe shards using <code>splitUtf8String</code>. Roblox automatically
    compresses buffers when encoding them using <code>JSONEncode</code>. This helps reduce the
    number of shards required, minimizing DataStore requests.
  </li>
</ol>
<p>
  <strong>Shard Key Naming:</strong> Shard data is stored using keys formatted as <code>{shardId}-{shardIndex}</code>,
  where <code>shardId</code> is a unique GUID generated for the file and <code>shardIndex</code> is the 1-based
  index of the shard.
</p>
</div></header><h2 class="anchor anchorWithStickyNavbar_LWe7" id="types">Types<a href="#types" class="hash-link" aria-label="Direct link to Types" title="Direct link to Types">​</a></h2><div class="divider_rE5g"></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="WriteParams"><code style="text-decoration:none">WriteParams</code><a href="#WriteParams" class="hash-link" aria-label="Direct link to WriteParams" title="Direct link to WriteParams">​</a></h3><div class="repositoryDetailsContainer_BPdw"><a class="sourceButton_sEho" href="https://github.com/paradoxum-games/lyra/blob/main/src/Files.luau#L58"><div class="sourceButtonText_Vh0m">&lt;/&gt;</div></a></div><div class="memberString_GwaU"><code class="purple_ieR2">interface</code> <code>WriteParams<!-- --> <!-- -->{</code><div class="inset_uKQm"><div><code>store<!-- -->: </code><code class="blue_P4bS"><a style="text-decoration:underline;color:inherit" href="https://developer.roblox.com/en-us/api-reference/class/DataStore" target="_blank" rel="noopener noreferrer">DataStore<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound" style="color:gray;vertical-align:middle;margin-left:2px"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></code><span class="inlineDescription_G7Er">-- <span>
<p>The DataStore instance to write to.</p>
</span></span></div><div><code>data<!-- -->: </code><code class="blue_P4bS">any</code><span class="inlineDescription_G7Er">-- <span>
<p>The Luau data to be stored. Must be JSON-encodable.</p>
</span></span></div><div><code>maxShardSize<!-- -->: </code><code class="blue_P4bS">number</code><span class="inlineDescription_G7Er">-- <span>
<p>The maximum size (in bytes) allowed for a single shard. Data exceeding this size after initial JSON encoding will trigger the sharding process.</p>
</span></span></div><div><code>key<!-- -->: </code><code class="blue_P4bS">string</code><span class="inlineDescription_G7Er">-- <span>
<p>The primary key under which the file metadata (or the full data if not sharded) will be conceptually associated. This key is <em>not</em> directly used for storing shards.</p>
</span></span></div><div><code>userIds<!-- -->: </code><code class="purple_ieR2">{</code><code class="blue_P4bS">number</code><code class="purple_ieR2">}</code><code class="blue_P4bS">?</code><span class="inlineDescription_G7Er">-- <span>
<p>An optional array of UserIDs for DataStore tagging.</p>
</span></span></div></div><code>}</code></div><div>
<p>Parameters required for the <code>write</code> function.</p>
</div><div class="divider_rE5g"></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="WriteError"><code style="text-decoration:none">WriteError</code><a href="#WriteError" class="hash-link" aria-label="Direct link to WriteError" title="Direct link to WriteError">​</a></h3><div class="repositoryDetailsContainer_BPdw"><a class="sourceButton_sEho" href="https://github.com/paradoxum-games/lyra/blob/main/src/Files.luau#L74"><div class="sourceButtonText_Vh0m">&lt;/&gt;</div></a></div><div class="memberString_GwaU"><code class="purple_ieR2">interface</code> <code>WriteError<!-- --> <!-- -->{</code><div class="inset_uKQm"><div><code>error<!-- -->: </code><code class="blue_P4bS">string</code><span class="inlineDescription_G7Er">-- <span>
<p>A string describing the error.</p>
</span></span></div><div><code>file<!-- -->: </code><code class="blue_P4bS"><a style="text-decoration:underline;color:inherit" href="/lyra/api/Types#File">File</a></code><span class="inlineDescription_G7Er">-- <span>
<p>The file metadata that was being processed when the error occurred. This is used for cleanup operations if shards were partially written.</p>
</span></span></div></div><code>}</code></div><div>
<p>Structure representing an error encountered during the <code>write</code> operation.</p>
</div><div class="divider_rE5g"></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="ReadParams"><code style="text-decoration:none">ReadParams</code><a href="#ReadParams" class="hash-link" aria-label="Direct link to ReadParams" title="Direct link to ReadParams">​</a></h3><div class="repositoryDetailsContainer_BPdw"><a class="sourceButton_sEho" href="https://github.com/paradoxum-games/lyra/blob/main/src/Files.luau#L146"><div class="sourceButtonText_Vh0m">&lt;/&gt;</div></a></div><div class="memberString_GwaU"><code class="purple_ieR2">interface</code> <code>ReadParams<!-- --> <!-- -->{</code><div class="inset_uKQm"><div><code>store<!-- -->: </code><code class="blue_P4bS"><a style="text-decoration:underline;color:inherit" href="https://developer.roblox.com/en-us/api-reference/class/DataStore" target="_blank" rel="noopener noreferrer">DataStore<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound" style="color:gray;vertical-align:middle;margin-left:2px"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></code><span class="inlineDescription_G7Er">-- <span>
<p>The DataStore instance to read from.</p>
</span></span></div><div><code>file<!-- -->: </code><code class="blue_P4bS"><a style="text-decoration:underline;color:inherit" href="/lyra/api/Types#File">File</a></code><span class="inlineDescription_G7Er">-- <span>
<p>The <a href="/lyra/api/Types#File">File</a> object obtained from a previous <code>write</code> operation or retrieved from the primary DataStore key. This object determines whether to read directly or reconstruct from shards.</p>
</span></span></div></div><code>}</code></div><div>
<p>Parameters required for the <code>read</code> function.</p>
</div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="functions">Functions<a href="#functions" class="hash-link" aria-label="Direct link to Functions" title="Direct link to Functions">​</a></h2><div class="divider_rE5g"></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="isLargeFile"><code style="text-decoration:none">isLargeFile</code><a href="#isLargeFile" class="hash-link" aria-label="Direct link to isLargeFile" title="Direct link to isLargeFile">​</a></h3><div class="repositoryDetailsContainer_BPdw"><a class="sourceButton_sEho" href="https://github.com/paradoxum-games/lyra/blob/main/src/Files.luau#L43"><div class="sourceButtonText_Vh0m">&lt;/&gt;</div></a></div><div class="memberString_GwaU"><code>Files<!-- -->.</code><code class="green_DgR4">isLargeFile</code><code>(</code><div class="inset_uKQm"><div><code>file<!-- -->: </code><code class="blue_P4bS"><a style="text-decoration:underline;color:inherit" href="/lyra/api/Types#File">File</a></code><span class="inlineDescription_G7Er">-- <span>
<p>The file object to check.</p>
</span></span></div></div><code>) → </code><code class="blue_P4bS">boolean</code><span class="inlineDescription_G7Er">-- <span>
<p>True if the file is sharded, false otherwise.</p>
</span></span></div><div>
<p>Checks if a file object represents a sharded file (i.e., data stored across multiple keys).</p>
</div><div class="divider_rE5g"></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="write"><code style="text-decoration:none">write</code><a href="#write" class="hash-link" aria-label="Direct link to write" title="Direct link to write">​</a></h3><div class="repositoryDetailsContainer_BPdw"><a class="sourceButton_sEho" href="https://github.com/paradoxum-games/lyra/blob/main/src/Files.luau#L95"><div class="sourceButtonText_Vh0m">&lt;/&gt;</div></a></div><div class="memberString_GwaU"><code>Files<!-- -->.</code><code class="green_DgR4">write</code><code>(</code><div class="inset_uKQm"><div><code>params<!-- -->: </code><code class="blue_P4bS"><a style="text-decoration:underline;color:inherit" href="/lyra/api/Files#WriteParams">WriteParams</a></code><span class="inlineDescription_G7Er">-- <span>
<p>The parameters for the write operation.</p>
</span></span></div></div><code>) → </code><code class="blue_P4bS">Promise</code><code class="op_lSLc">&lt;</code><code class="blue_P4bS"><a style="text-decoration:underline;color:inherit" href="/lyra/api/Types#File">File</a></code><code class="op_lSLc">&gt;</code><span class="inlineDescription_G7Er">-- <span>
<p>A Promise that resolves with a <a href="/lyra/api/Types#File">File</a> object representing the stored data (either directly containing the data or shard metadata).</p>
</span></span></div><div>
<p>Writes data to the DataStore, automatically handling sharding and compression if necessary.</p>
<p>
  If the JSON-encoded data is smaller than <code>maxShardSize</code>, it's stored directly within the
  returned <a href="/lyra/api/Types#File">File</a> object (in the <code>data</code> field).
</p>
<p>
  If the data is larger, it's compressed, sharded, and stored across multiple DataStore keys.
  The returned <a href="/lyra/api/Types#File">File</a> object will contain <code>shard</code> (the unique ID for the shards) and
  <code>count</code> (the number of shards) instead of the <code>data</code> field.
</p>
</div><h3>Errors</h3><table class="errorTable_jfN8"><thead><tr><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>WriteError</td><td>Rejects with a `WriteError` if any shard fails to write.</td></tr><tr><td>string</td><td>Propagates errors from `DataStore:SetAsync` via `dataStoreRetry`.</td></tr></tbody></table><div class="divider_rE5g"></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="read"><code style="text-decoration:none">read</code><a href="#read" class="hash-link" aria-label="Direct link to read" title="Direct link to read">​</a></h3><div class="repositoryDetailsContainer_BPdw"><a class="sourceButton_sEho" href="https://github.com/paradoxum-games/lyra/blob/main/src/Files.luau#L163"><div class="sourceButtonText_Vh0m">&lt;/&gt;</div></a></div><div class="memberString_GwaU"><code>Files<!-- -->.</code><code class="green_DgR4">read</code><code>(</code><div class="inset_uKQm"><div><code>params<!-- -->: </code><code class="blue_P4bS"><a style="text-decoration:underline;color:inherit" href="/lyra/api/Files#ReadParams">ReadParams</a></code><span class="inlineDescription_G7Er">-- <span>
<p>The parameters for the read operation.</p>
</span></span></div></div><code>) → </code><code class="blue_P4bS">Promise</code><code class="op_lSLc">&lt;</code><code class="blue_P4bS">any</code><code class="op_lSLc">&gt;</code><span class="inlineDescription_G7Er">-- <span>
<p>A Promise that resolves with the original data.</p>
</span></span></div><div>
<p>Reads data from the DataStore, automatically handling reconstruction from shards if necessary.</p>
<p>
  If the provided <code>file</code> object contains the <code>data</code> field directly, it returns that data.
  If the <code>file</code> object contains <code>shard</code> and <code>count</code> fields, it reads all corresponding shards
  from the DataStore, concatenates them, decompresses the result, and returns the original data.
</p>
</div><h3>Errors</h3><table class="errorTable_jfN8"><thead><tr><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>string</td><td>Rejects with an error message string if any shard is missing or if decoding/decompression fails. Propagates errors from `DataStore:GetAsync` via `dataStoreRetry`.</td></tr></tbody></table></div></article></div><details><summary>Show raw api</summary><pre style="max-width:100%;white-space:pre-wrap">{
    &quot;functions&quot;: [
        {
            &quot;name&quot;: &quot;isLargeFile&quot;,
            &quot;desc&quot;: &quot;Checks if a file object represents a sharded file (i.e., data stored across multiple keys).&quot;,
            &quot;params&quot;: [
                {
                    &quot;name&quot;: &quot;file&quot;,
                    &quot;desc&quot;: &quot;The file object to check.&quot;,
                    &quot;lua_type&quot;: &quot;File&quot;
                }
            ],
            &quot;returns&quot;: [
                {
                    &quot;desc&quot;: &quot;True if the file is sharded, false otherwise.&quot;,
                    &quot;lua_type&quot;: &quot;boolean&quot;
                }
            ],
            &quot;function_type&quot;: &quot;static&quot;,
            &quot;source&quot;: {
                &quot;line&quot;: 43,
                &quot;path&quot;: &quot;src/Files.luau&quot;
            }
        },
        {
            &quot;name&quot;: &quot;write&quot;,
            &quot;desc&quot;: &quot;Writes data to the DataStore, automatically handling sharding and compression if necessary.\n\nIf the JSON-encoded data is smaller than `maxShardSize`, it&#x27;s stored directly within the\nreturned [File] object (in the `data` field).\n\nIf the data is larger, it&#x27;s compressed, sharded, and stored across multiple DataStore keys.\nThe returned [File] object will contain `shard` (the unique ID for the shards) and\n`count` (the number of shards) instead of the `data` field.&quot;,
            &quot;params&quot;: [
                {
                    &quot;name&quot;: &quot;params&quot;,
                    &quot;desc&quot;: &quot;The parameters for the write operation.&quot;,
                    &quot;lua_type&quot;: &quot;WriteParams&quot;
                }
            ],
            &quot;returns&quot;: [
                {
                    &quot;desc&quot;: &quot;A Promise that resolves with a [File] object representing the stored data (either directly containing the data or shard metadata).&quot;,
                    &quot;lua_type&quot;: &quot;Promise&lt;File&gt;&quot;
                }
            ],
            &quot;function_type&quot;: &quot;static&quot;,
            &quot;errors&quot;: [
                {
                    &quot;lua_type&quot;: &quot;WriteError&quot;,
                    &quot;desc&quot;: &quot;Rejects with a `WriteError` if any shard fails to write.&quot;
                },
                {
                    &quot;lua_type&quot;: &quot;string&quot;,
                    &quot;desc&quot;: &quot;Propagates errors from `DataStore:SetAsync` via `dataStoreRetry`.&quot;
                }
            ],
            &quot;source&quot;: {
                &quot;line&quot;: 95,
                &quot;path&quot;: &quot;src/Files.luau&quot;
            }
        },
        {
            &quot;name&quot;: &quot;read&quot;,
            &quot;desc&quot;: &quot;Reads data from the DataStore, automatically handling reconstruction from shards if necessary.\n\nIf the provided `file` object contains the `data` field directly, it returns that data.\nIf the `file` object contains `shard` and `count` fields, it reads all corresponding shards\nfrom the DataStore, concatenates them, decompresses the result, and returns the original data.&quot;,
            &quot;params&quot;: [
                {
                    &quot;name&quot;: &quot;params&quot;,
                    &quot;desc&quot;: &quot;The parameters for the read operation.&quot;,
                    &quot;lua_type&quot;: &quot;ReadParams&quot;
                }
            ],
            &quot;returns&quot;: [
                {
                    &quot;desc&quot;: &quot;A Promise that resolves with the original data.&quot;,
                    &quot;lua_type&quot;: &quot;Promise&lt;any&gt;&quot;
                }
            ],
            &quot;function_type&quot;: &quot;static&quot;,
            &quot;errors&quot;: [
                {
                    &quot;lua_type&quot;: &quot;string&quot;,
                    &quot;desc&quot;: &quot;Rejects with an error message string if any shard is missing or if decoding/decompression fails. Propagates errors from `DataStore:GetAsync` via `dataStoreRetry`.&quot;
                }
            ],
            &quot;source&quot;: {
                &quot;line&quot;: 163,
                &quot;path&quot;: &quot;src/Files.luau&quot;
            }
        }
    ],
    &quot;properties&quot;: [],
    &quot;types&quot;: [
        {
            &quot;name&quot;: &quot;WriteParams&quot;,
            &quot;desc&quot;: &quot;Parameters required for the `write` function.\n\t&quot;,
            &quot;fields&quot;: [
                {
                    &quot;name&quot;: &quot;store&quot;,
                    &quot;lua_type&quot;: &quot;DataStore&quot;,
                    &quot;desc&quot;: &quot;The DataStore instance to write to.&quot;
                },
                {
                    &quot;name&quot;: &quot;data&quot;,
                    &quot;lua_type&quot;: &quot;any&quot;,
                    &quot;desc&quot;: &quot;The Luau data to be stored. Must be JSON-encodable.&quot;
                },
                {
                    &quot;name&quot;: &quot;maxShardSize&quot;,
                    &quot;lua_type&quot;: &quot;number&quot;,
                    &quot;desc&quot;: &quot;The maximum size (in bytes) allowed for a single shard. Data exceeding this size after initial JSON encoding will trigger the sharding process.&quot;
                },
                {
                    &quot;name&quot;: &quot;key&quot;,
                    &quot;lua_type&quot;: &quot;string&quot;,
                    &quot;desc&quot;: &quot;The primary key under which the file metadata (or the full data if not sharded) will be conceptually associated. This key is *not* directly used for storing shards.&quot;
                },
                {
                    &quot;name&quot;: &quot;userIds&quot;,
                    &quot;lua_type&quot;: &quot;{ number }?&quot;,
                    &quot;desc&quot;: &quot;An optional array of UserIDs for DataStore tagging.&quot;
                }
            ],
            &quot;source&quot;: {
                &quot;line&quot;: 58,
                &quot;path&quot;: &quot;src/Files.luau&quot;
            }
        },
        {
            &quot;name&quot;: &quot;WriteError&quot;,
            &quot;desc&quot;: &quot;Structure representing an error encountered during the `write` operation.&quot;,
            &quot;fields&quot;: [
                {
                    &quot;name&quot;: &quot;error&quot;,
                    &quot;lua_type&quot;: &quot;string&quot;,
                    &quot;desc&quot;: &quot;A string describing the error.&quot;
                },
                {
                    &quot;name&quot;: &quot;file&quot;,
                    &quot;lua_type&quot;: &quot;File&quot;,
                    &quot;desc&quot;: &quot;The file metadata that was being processed when the error occurred. This is used for cleanup operations if shards were partially written.&quot;
                }
            ],
            &quot;source&quot;: {
                &quot;line&quot;: 74,
                &quot;path&quot;: &quot;src/Files.luau&quot;
            }
        },
        {
            &quot;name&quot;: &quot;ReadParams&quot;,
            &quot;desc&quot;: &quot;Parameters required for the `read` function.&quot;,
            &quot;fields&quot;: [
                {
                    &quot;name&quot;: &quot;store&quot;,
                    &quot;lua_type&quot;: &quot;DataStore&quot;,
                    &quot;desc&quot;: &quot;The DataStore instance to read from.&quot;
                },
                {
                    &quot;name&quot;: &quot;file&quot;,
                    &quot;lua_type&quot;: &quot;File&quot;,
                    &quot;desc&quot;: &quot;The [File] object obtained from a previous `write` operation or retrieved from the primary DataStore key. This object determines whether to read directly or reconstruct from shards.&quot;
                }
            ],
            &quot;source&quot;: {
                &quot;line&quot;: 146,
                &quot;path&quot;: &quot;src/Files.luau&quot;
            }
        }
    ],
    &quot;name&quot;: &quot;Files&quot;,
    &quot;desc&quot;: &quot;Handles the storage and retrieval of potentially large data blobs within Roblox DataStores,\nworking around the size limitations imposed by DataStore `SetAsync`/`GetAsync` calls.\n\n**Core Problem:** Roblox DataStores have a maximum size limit per key (currently 4MB).\nData that exceeds this limit cannot be stored directly.\n\n**Solution: Sharding &amp; Compression**\n1.  **Sharding:** If the JSON-encoded data exceeds the configured `maxShardSize`, it is\n    split into multiple smaller chunks (shards). Metadata about these shards (a unique\n    shard ID and the total shard count) is stored in the primary DataStore entry for the\n    original key, while the actual shard data is stored under separate keys derived from\n    the shard ID.\n2.  **Compression:** Before sharding, the JSON-encoded data is converted to binary using\n    `buffer.fromstring`. This binary representation is then JSON-encoded *again* before\n    being split into UTF-8 safe shards using `splitUtf8String`. Roblox automatically\n\tcompresses buffers when encoding them using `JSONEncode`. This helps reduce the\n    number of shards required, minimizing DataStore requests.\n\n**Shard Key Naming:** Shard data is stored using keys formatted as `{shardId}-{shardIndex}`,\nwhere `shardId` is a unique GUID generated for the file and `shardIndex` is the 1-based\nindex of the shard.&quot;,
    &quot;private&quot;: true,
    &quot;source&quot;: {
        &quot;line&quot;: 27,
        &quot;path&quot;: &quot;src/Files.luau&quot;
    }
}</pre></details></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#types" class="table-of-contents__link toc-highlight">Types</a><ul><li><a href="#ReadParams" class="table-of-contents__link toc-highlight">ReadParams</a></li><li><a href="#WriteError" class="table-of-contents__link toc-highlight">WriteError</a></li><li><a href="#WriteParams" class="table-of-contents__link toc-highlight">WriteParams</a></li></ul></li><li><a href="#functions" class="table-of-contents__link toc-highlight">Functions</a><ul><li><a href="#isLargeFile" class="table-of-contents__link toc-highlight">.isLargeFile</a></li><li><a href="#read" class="table-of-contents__link toc-highlight">.read</a></li><li><a href="#write" class="table-of-contents__link toc-highlight">.write</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Links</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/paradoxum-games/lyra" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Built with Moonwave and Docusaurus</div></div></div></footer></div>
</body>
</html>